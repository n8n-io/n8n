# 分支同步指南

## 自动同步说明

### Master 分支
- **自动同步**：GitHub Actions 每天自动同步上游更新
- **时间**：每天 UTC 0 点（北京时间 08:00）
- **范围**：仅同步到 `master` 分支
- **状态**：可以在 GitHub Actions 页面查看执行结果

### 开发分支
- **手动同步**：开发者根据需要自行同步
- **方式**：通过 Git 命令手动合并
- **决策**：由开发团队根据当前开发进度决定

## 手动同步开发分支

### 场景 1：开发分支需要最新上游更新

```bash
# 1. 切换到要更新的开发分支
git checkout feature/your-feature-branch

# 2. 先更新本地 master
git checkout master
git pull origin master

# 3. 将 master 合并到开发分支
git checkout feature/your-feature-branch
git merge master

# 4. 解决冲突（如果有）
# 编辑冲突文件后：
git add <冲突文件>
git commit -m "合并：同步上游更新到开发分支"

# 5. 推送到远程
git push origin feature/your-feature-branch
```

### 场景 2：从上游直接同步特定功能

```bash
# 1. 添加上游仓库（如果还没有）
git remote add upstream https://github.com/n8n-io/n8n.git

# 2. 获取上游更新
git fetch upstream

# 3. 切换到开发分支
git checkout feature/your-feature-branch

# 4. 从上游 master 合并特定提交
git cherry-pick <commit-hash>
# 或
git merge upstream/master --no-edit

# 5. 解决冲突并推送
```

## 最佳实践

### 何时同步开发分支

1. **项目启动时**：创建新开发分支后，应立即与 master 同步
2. **定期同步**：建议每周或每两周同步一次，避免冲突积累
3. **开发间隙**：完成一个功能模块后同步更新
4. **紧急修复**：上游有重要安全或 Bug 修复时优先同步

### 冲突解决策略

```bash
# 查看冲突文件
git status

# 手动编辑冲突文件，保留需要的代码
# 添加解决后的文件
git add .

# 如果合并时出现冲突，使用 abort 取消
git merge --abort
```

### 创建同步模板

```bash
# 创建同步脚本 sync-branch.sh
#!/bin/bash
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)

echo "🔄 同步分支 $BRANCH_NAME 到最新 master"
git checkout master
git pull origin master
git checkout $BRANCH_NAME
git merge master

echo "✅ 同步完成，请检查冲突"
```

## 注意事项

⚠️ **重要提醒**
- 始终在独立分支上进行开发，避免直接在 master 分支工作
- 同步前确保当前分支的修改已提交或暂存
- 大型功能开发期间建议减少同步频率，避免频繁冲突
- 同步后及时测试功能是否正常

## 常见问题

**Q：开发分支落后太多，同步困难怎么办？**
A：
1. 在 master 上创建新分支：git checkout -b feature/new-branch-from-master
2. 手动移植代码到新分支
3. 废弃旧分支

**Q：可以跳过测试直接同步吗？**
A：不建议。同步后应运行测试确保功能正常。
```bash
pnpm install
pnpm build
pnpm test
```

**Q：如何查看上游有哪些新提交？**
A：
```bash
git log --oneline master..upstream/master
```

## 联系支持

如遇到同步问题，请联系技术负责人或在团队频道寻求帮助。
