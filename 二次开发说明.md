# n8n äºŒæ¬¡å¼€å‘è¯´æ˜æ–‡æ¡£

## é¡¹ç›®ä¿¡æ¯

- **åŸé¡¹ç›®**: n8n - Workflow Automation Platform
- **å½“å‰åˆ†æ”¯**: `20251102`
- **äºŒæ¬¡å¼€å‘ç›®çš„**: ç§»é™¤æ‰€æœ‰è®¸å¯è¯é™åˆ¶ï¼Œè§£é”å…¨éƒ¨ä¼ä¸šç‰ˆåŠŸèƒ½ï¼Œä»…ä¾›å†…éƒ¨å›¢é˜Ÿä½¿ç”¨

## å¼€å‘è¿›åº¦

### å½“å‰çŠ¶æ€
ğŸ”„ **è¿›è¡Œä¸­** - åç«¯è¿˜æœ‰çº¦40ä¸ªç¼–è¯‘é”™è¯¯éœ€è¦ä¿®å¤

**å½“å‰é”™è¯¯ç±»å‹**:
1. åç«¯æ¨¡å—ä»åœ¨å¼•ç”¨ `@/license` (çº¦15ä¸ªæ–‡ä»¶)
2. åç«¯æ¨¡å—å¼•ç”¨ `LICENSE_FEATURES` å¸¸é‡ (çº¦5ä¸ªæ–‡ä»¶)
3. åç«¯æ¨¡å—å¼•ç”¨ `LicenseState` (çº¦8ä¸ªæ–‡ä»¶)
4. æ¨¡å—å®šä¹‰ä¸­ä½¿ç”¨äº† `licenseFlag` å‚æ•° (2ä¸ªæ¨¡å—)
5. å¼•ç”¨å·²åˆ é™¤çš„ `feature-not-licensed.error` (çº¦3ä¸ªæ–‡ä»¶)

### å·²å®Œæˆçš„å·¥ä½œ

#### 1. åç«¯ License æ ¸å¿ƒæ–‡ä»¶åˆ é™¤ âœ…
- âœ… åˆ é™¤ `packages/cli/src/license/` æ•´ä¸ªç›®å½•
- âœ… åˆ é™¤ `packages/cli/src/license.ts` ä¸»æœåŠ¡æ–‡ä»¶
- âœ… åˆ é™¤ `packages/@n8n/config/src/configs/license.config.ts` é…ç½®æ–‡ä»¶
- âœ… åˆ é™¤ `packages/cli/src/metrics/license-metrics.service.ts` æŒ‡æ ‡æœåŠ¡
- âœ… åˆ é™¤ `packages/cli/src/errors/feature-not-licensed.error.ts` é”™è¯¯ç±»
- âœ… åˆ é™¤ `packages/@n8n/backend-common/src/license-state.ts` çŠ¶æ€æä¾›è€…
- âœ… åˆ é™¤ `packages/@n8n/backend-common/src/types.ts` ç±»å‹å®šä¹‰
- âœ… åˆ é™¤ `packages/cli/src/commands/license/` CLI å‘½ä»¤

#### 2. License è£…é¥°å™¨æ¸…ç† âœ…
- âœ… åˆ é™¤ `packages/@n8n/decorators/src/controller/licensed.ts` è£…é¥°å™¨æ–‡ä»¶
- âœ… ä» `packages/@n8n/decorators/src/controller/index.ts` ç§»é™¤ Licensed å¯¼å‡º
- âœ… ä» `packages/@n8n/decorators/src/controller/types.ts` ç§»é™¤ licenseFeature å­—æ®µ
- âœ… ä» `packages/@n8n/decorators/src/module/module.ts` ç§»é™¤ license ç›¸å…³ç±»å‹
- âœ… ç®€åŒ– `ModuleMetadata` ç§»é™¤ licenseFlag æ”¯æŒ

#### 3. åç«¯ @Licensed è£…é¥°å™¨ä½¿ç”¨æ¸…ç† âœ…
å·²æ¸…ç†ä»¥ä¸‹æ§åˆ¶å™¨ä¸­çš„ @Licensed è£…é¥°å™¨ï¼š
- âœ… `ai.controller.ts`
- âœ… `api-keys.controller.ts`
- âœ… `audit.controller.ee.ts`
- âœ… `auth.controller.ts`
- âœ… `debug.controller.ts`
- âœ… `external-secrets.controller.ee.ts`
- âœ… `invitation.controller.ts`
- âœ… `ldap.controller.ee.ts`
- âœ… `me.controller.ts`
- âœ… `mfa.controller.ts`
- âœ… `orchestration.controller.ts`
- âœ… `project.controller.ts`
- âœ… `role.controller.ts`
- âœ… `saml.controller.ee.ts`
- âœ… `source-control.controller.ee.ts`
- âœ… `translation.controller.ts`
- âœ… `users.controller.ts`
- âœ… `workflow-history.controller.ee.ts`
- âœ… `workflow-statistics.controller.ts`
- âœ… `workflows.controller.ts`

#### 4. å‰ç«¯ä¼ä¸šç‰ˆæ£€æŸ¥ç»„ä»¶åˆ é™¤ âœ…
- âœ… åˆ é™¤ `packages/frontend/editor-ui/src/app/components/EnterpriseEdition.ee.vue`
- âœ… åˆ é™¤ `packages/frontend/editor-ui/src/app/utils/rbac/middleware/enterprise.ts`
- âœ… åˆ›å»ºå­˜æ ¹å‡½æ•° `isEnterpriseFeatureEnabled.ts` å§‹ç»ˆè¿”å› true
- âœ… ä» middleware.ts ç§»é™¤ enterpriseMiddleware

#### 5. å‰ç«¯ EnterpriseEdition ç»„ä»¶ä½¿ç”¨æ¸…ç† âœ…
- âœ… `MoveToFolderModal.vue` - ç§»é™¤ EnterpriseEdition ç»„ä»¶åŒ…è£…
- âœ… `ResourceFiltersDropdown.vue` - ç§»é™¤ EnterpriseEdition ç»„ä»¶åŒ…è£…
- âœ… æ‰¹é‡åˆ é™¤æ‰€æœ‰æ–‡ä»¶ä¸­çš„ `EnterpriseEditionFeature` å¼•ç”¨ï¼ˆ42ä¸ªæ–‡ä»¶ï¼‰

#### 6. è®¸å¯è¯å¸¸é‡å’Œç±»å‹åˆ é™¤ âœ…
- âœ… ä» `packages/@n8n/constants/src/index.ts` åˆ é™¤ï¼š
  - `LICENSE_FEATURES` å¸¸é‡ï¼ˆ40+ ä¸ªä¼ä¸šåŠŸèƒ½ï¼‰
  - `LICENSE_QUOTAS` å¸¸é‡ï¼ˆ10+ ä¸ªé…é¢é™åˆ¶ï¼‰
  - `BooleanLicenseFeature` ç±»å‹
  - `NumericLicenseFeature` ç±»å‹

#### 7. ä¾èµ–åŒ…æ¸…ç† âœ…
- âœ… ä» `packages/cli/package.json` ç§»é™¤ `@n8n_io/license-sdk` ä¾èµ–
- âœ… è¿è¡Œ `pnpm install` æ¸…ç†ä¾èµ–

#### 8. é…ç½®æ–‡ä»¶æ¸…ç† âœ…
- âœ… ä» `packages/@n8n/config/src/index.ts` ç§»é™¤ license.config å¼•ç”¨
- âœ… ä» `packages/@n8n/backend-common/src/index.ts` ç§»é™¤ license-state å¯¼å‡º

#### 9. ModuleRegistry ç®€åŒ– âœ…
- âœ… ç§»é™¤ `LicenseState` æ„é€ å‡½æ•°ä¾èµ–
- âœ… ç§»é™¤ `initModules()` ä¸­çš„è®¸å¯è¯æ£€æŸ¥é€»è¾‘
- âœ… æ‰€æœ‰æ¨¡å—ç°åœ¨æ— æ¡ä»¶åˆå§‹åŒ–

### å¾…å®Œæˆçš„å·¥ä½œ

#### 10. æ„å»ºé”™è¯¯ä¿®å¤ ğŸ”„
- ğŸ”„ ä¿®å¤ `Interface.ts` ä¸­çš„è¯­æ³•é”™è¯¯ï¼ˆå·²ä¿®å¤å¤§éƒ¨åˆ†ï¼‰
- â³ ä¿®å¤å…¶ä»–å¯èƒ½çš„æ„å»ºé”™è¯¯
- â³ å®Œæˆå®Œæ•´çš„ `pnpm build`

#### 11. ç±»å‹æ£€æŸ¥ â³
- â³ è¿è¡Œ `pnpm typecheck`
- â³ ä¿®å¤æ‰€æœ‰ TypeScript ç±»å‹é”™è¯¯

#### 12. ä»£ç é£æ ¼æ£€æŸ¥ â³
- â³ è¿è¡Œ `pnpm lint`
- â³ ä¿®å¤ä»£ç é£æ ¼é—®é¢˜

#### 13. åŠŸèƒ½æµ‹è¯• â³
- â³ éªŒè¯åº”ç”¨èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨
- â³ æµ‹è¯•æ‰€æœ‰ä¼ä¸šåŠŸèƒ½æ˜¯å¦å¯ç”¨ï¼š
  - LDAP è®¤è¯
  - SAML è®¤è¯
  - å˜é‡ç®¡ç†
  - æ—¥å¿—æµ
  - æºä»£ç ç®¡ç†
  - å¤–éƒ¨å¯†é’¥
  - å·¥ä½œæµå†å²
  - é«˜çº§æ‰§è¡Œè¿‡æ»¤
  - API å¯†é’¥
  - é¡¹ç›®æƒé™
  - ç­‰ç­‰...

## ä¸åŸç‰ˆé¡¹ç›®çš„ä¸»è¦å·®å¼‚

### æ¶æ„å˜æ›´

#### 1. è®¸å¯è¯éªŒè¯æœºåˆ¶å®Œå…¨ç§»é™¤
**åŸç‰ˆè¡Œä¸º**:
- é€šè¿‡ `@n8n_io/license-sdk` è¿æ¥ `https://license.n8n.io/v1` éªŒè¯è®¸å¯è¯
- ä½¿ç”¨ `@Licensed` è£…é¥°å™¨åœ¨æ§åˆ¶å™¨æ–¹æ³•çº§åˆ«æ£€æŸ¥åŠŸèƒ½æƒé™
- å‰ç«¯ä½¿ç”¨ `isEnterpriseFeatureEnabled` æ£€æŸ¥ç‰¹æ€§å¼€å…³
- æ¨¡å—åˆå§‹åŒ–æ—¶æ£€æŸ¥ `licenseFlag` å†³å®šæ˜¯å¦å¯ç”¨

**äºŒæ¬¡å¼€å‘å**:
- âœ… å®Œå…¨åˆ é™¤ license-sdk ä¾èµ–ï¼Œæ— ç½‘ç»œéªŒè¯
- âœ… ç§»é™¤æ‰€æœ‰ @Licensed è£…é¥°å™¨ï¼Œæ‰€æœ‰ API æ— æ¡ä»¶å¯ç”¨
- âœ… `isEnterpriseFeatureEnabled` å§‹ç»ˆè¿”å› `true`
- âœ… æ‰€æœ‰æ¨¡å—æ— æ¡ä»¶åˆå§‹åŒ–

#### 2. ä¼ä¸šåŠŸèƒ½æ— æ¡ä»¶è§£é”
**åŸç‰ˆè¡Œä¸º**:
- LDAP/SAML éœ€è¦ä¼ä¸šè®¸å¯è¯
- å˜é‡ç®¡ç†éœ€è¦è®¸å¯è¯
- æ—¥å¿—æµéœ€è¦è®¸å¯è¯
- æºä»£ç ç®¡ç†éœ€è¦è®¸å¯è¯
- å·¥ä½œæµå†å²éœ€è¦è®¸å¯è¯
- é«˜çº§æ‰§è¡Œè¿‡æ»¤éœ€è¦è®¸å¯è¯

**äºŒæ¬¡å¼€å‘å**:
- âœ… æ‰€æœ‰ä¼ä¸šåŠŸèƒ½é»˜è®¤å¯ç”¨
- âœ… æ— è®¸å¯è¯æ£€æŸ¥é€»è¾‘
- âœ… æ— é…é¢é™åˆ¶

#### 3. å‰ç«¯ UI ç®€åŒ–
**åŸç‰ˆè¡Œä¸º**:
- ä½¿ç”¨ `<EnterpriseEdition>` ç»„ä»¶åŒ…è£…ä¼ä¸šåŠŸèƒ½ UI
- æ ¹æ®è®¸å¯è¯çŠ¶æ€æ˜¾ç¤º/éšè—åŠŸèƒ½
- æ˜¾ç¤ºå‡çº§æç¤º

**äºŒæ¬¡å¼€å‘å**:
- âœ… ç§»é™¤æ‰€æœ‰ `EnterpriseEdition` ç»„ä»¶åŒ…è£…
- âœ… æ‰€æœ‰ UI ç›´æ¥æ˜¾ç¤ºï¼Œæ— æ¡ä»¶åˆ¤æ–­
- âœ… æ— å‡çº§æç¤º

### ä»£ç çº§åˆ«å˜æ›´ç»Ÿè®¡

| ç±»åˆ« | åˆ é™¤æ–‡ä»¶æ•° | ä¿®æ”¹æ–‡ä»¶æ•° | åˆ é™¤è¡Œæ•°ï¼ˆä¼°ç®—ï¼‰ |
|------|-----------|-----------|----------------|
| åç«¯ License æ ¸å¿ƒ | 15+ | 0 | 3000+ |
| åç«¯è£…é¥°å™¨ç³»ç»Ÿ | 1 | 5 | 50+ |
| åç«¯æ§åˆ¶å™¨æ¸…ç† | 0 | 20+ | 100+ |
| å‰ç«¯ä¼ä¸šæ£€æŸ¥ | 4 | 3 | 200+ |
| å‰ç«¯ç»„ä»¶æ¸…ç† | 0 | 42 | 300+ |
| å¸¸é‡å’Œç±»å‹ | 0 | 3 | 100+ |
| é…ç½®æ–‡ä»¶ | 1 | 3 | 50+ |
| **æ€»è®¡** | **21+** | **76+** | **3800+** |

### é…ç½®å·®å¼‚

#### package.json ä¾èµ–å˜æ›´
```diff
# packages/cli/package.json
- "@n8n_io/license-sdk": "2.24.1"
```

#### TypeScript ç±»å‹å˜æ›´
```diff
# packages/@n8n/decorators/src/controller/types.ts
export interface RouteMetadata {
  method: Method;
  path: string;
- licenseFeature?: BooleanLicenseFeature;
  accessScope?: AccessScope;
  // ...
}
```

```diff
# packages/@n8n/decorators/src/module/module.ts
export const BackendModule =
- (opts: { name: string; licenseFlag?: LicenseFlag | LicenseFlag[] }): ClassDecorator =>
+ (opts: { name: string }): ClassDecorator =>
  (target) => {
    // ...
  };
```

### è¿è¡Œæ—¶è¡Œä¸ºå·®å¼‚

#### 1. ç½‘ç»œè¯·æ±‚
**åŸç‰ˆ**: å®šæœŸå‘ `https://license.n8n.io/v1` å‘é€éªŒè¯è¯·æ±‚
**äºŒæ¬¡å¼€å‘**: æ— ä»»ä½•è®¸å¯è¯ç›¸å…³çš„ç½‘ç»œè¯·æ±‚

#### 2. åŠŸèƒ½å¯ç”¨æ€§
**åŸç‰ˆ**: æ ¹æ®è®¸å¯è¯ç±»å‹é™åˆ¶åŠŸèƒ½
**äºŒæ¬¡å¼€å‘**: æ‰€æœ‰åŠŸèƒ½æ— æ¡ä»¶å¯ç”¨

#### 3. ç”¨æˆ·ä½“éªŒ
**åŸç‰ˆ**: ç¤¾åŒºç‰ˆç”¨æˆ·çœ‹åˆ°ä¼ä¸šåŠŸèƒ½çš„å‡çº§æç¤º
**äºŒæ¬¡å¼€å‘**: æ— ä»»ä½•è®¸å¯è¯ç›¸å…³æç¤ºï¼Œæ‰€æœ‰åŠŸèƒ½ç›´æ¥å¯ç”¨

## æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æé†’

1. **ä»…ä¾›å†…éƒ¨ä½¿ç”¨**: æ­¤äºŒæ¬¡å¼€å‘ç‰ˆæœ¬ä»…ç”¨äºå›¢é˜Ÿå†…éƒ¨ï¼Œä¸å¾—å¯¹å¤–å‘å¸ƒæˆ–å•†ä¸šä½¿ç”¨
2. **å®‰å…¨è€ƒè™‘**: ç§»é™¤è®¸å¯è¯æ£€æŸ¥åï¼Œéœ€è¦è‡ªè¡Œå®ç°è®¿é—®æ§åˆ¶å’Œå®‰å…¨æœºåˆ¶
3. **æ›´æ–°é£é™©**: ä¸ä¸Šæ¸¸ n8n é¡¹ç›®åŒæ­¥æ—¶ï¼Œéœ€è¦é‡æ–°åº”ç”¨æ‰€æœ‰è®¸å¯è¯ç§»é™¤çš„ä¿®æ”¹
4. **æ³•å¾‹åˆè§„**: ç¡®ä¿ä½¿ç”¨åœºæ™¯ç¬¦åˆ n8n çš„å¼€æºè®¸å¯è¯è¦æ±‚

### ğŸ“‹ ç»´æŠ¤å»ºè®®

1. **ç‰ˆæœ¬ç®¡ç†**: åœ¨æ­¤åˆ†æ”¯çš„æ‰€æœ‰æäº¤ä¿¡æ¯ä¸­æ˜ç¡®æ ‡æ³¨"äºŒæ¬¡å¼€å‘"
2. **æ–‡æ¡£æ›´æ–°**: æ¯æ¬¡å¤§çš„ä¿®æ”¹åæ›´æ–°æ­¤æ–‡æ¡£
3. **æµ‹è¯•è¦†ç›–**: é‡ç‚¹æµ‹è¯•ä¼ä¸šåŠŸèƒ½çš„å¯ç”¨æ€§
4. **å®‰å…¨åŠ å›º**: è‡ªè¡Œå®ç°å¿…è¦çš„æƒé™æ§åˆ¶å’Œå®‰å…¨æªæ–½

## æ„å»ºå’Œè¿è¡Œ

### æ„å»ºå‘½ä»¤
```bash
# å®Œæ•´æ„å»º
pnpm build

# ç±»å‹æ£€æŸ¥
pnpm typecheck

# ä»£ç æ£€æŸ¥
pnpm lint

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
pnpm dev
```

### å½“å‰æ„å»ºçŠ¶æ€
- âŒ `pnpm build` - æœ‰è¯­æ³•é”™è¯¯ï¼Œæ­£åœ¨ä¿®å¤
- â³ `pnpm typecheck` - æœªè¿è¡Œ
- â³ `pnpm lint` - æœªè¿è¡Œ

## æ›´æ–°æ—¥å¿—

### 2025-11-03
- åˆå§‹åŒ–äºŒæ¬¡å¼€å‘å·¥ä½œ
- å®Œæˆåç«¯ License æ ¸å¿ƒåˆ é™¤
- å®Œæˆå‰ç«¯ä¼ä¸šç‰ˆæ£€æŸ¥ç§»é™¤
- æ‰¹é‡æ¸…ç† EnterpriseEditionFeature å¼•ç”¨
- åˆ›å»ºæ­¤æ–‡æ¡£

---

*æœ€åæ›´æ–°: 2025-11-03*
*ç»´æŠ¤è€…: å¼€å‘å›¢é˜Ÿ*
